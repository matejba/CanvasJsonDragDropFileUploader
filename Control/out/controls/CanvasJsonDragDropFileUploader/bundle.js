/*! For license information please see bundle.js.LICENSE.txt */
var pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad;(()=>{"use strict";var e={d:(t,l)=>{for(var i in l)e.o(l,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:l[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{CanvasJsonDragDropFileUploader:()=>l});class l{constructor(){this.files=[],this.maxFiles=null,this.allowedFormats=null,this.saveButtonColor=null,this.isLoading=!1,this.errorTimeoutId=null,this.lastResetToken=null,this.renameDialogBackdrop=null,this.renameDialog=null,this.renameInput=null,this.renameExtLabel=null,this.renameError=null,this.renameOkButton=null,this.currentRenameIndex=null,this.currentRenameExt=""}clearFiles(){console.log("clearFiles"),this.files=[],this.fileInput&&(this.fileInput.value=""),this.setError(null),this.renderFilesList(),this.notifyOutputChanged()}getFileExt(e){var t=(e||"").trim(),l=t.lastIndexOf(".");return l<=0?"":t.substring(l)}getFileBase(e){var t=(e||"").trim(),l=t.lastIndexOf(".");return l<=0?t:t.substring(0,l)}applyRenameOkButtonStyle(){if(this.renameOkButton){var e=(this.saveButtonColor||"").trim(),t=e.length>0?e:"#0078d4";this.renameOkButton.style.border="1px solid ".concat(t),this.renameOkButton.style.background=t}}ensureRenameDialog(){if(!this.renameDialogBackdrop){var e=document.createElement("div");e.style.position="fixed",e.style.inset="0",e.style.background="rgba(0,0,0,0.35)",e.style.display="none",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="9999";var t=document.createElement("div");t.style.width="min(440px, calc(100vw - 32px))",t.style.background="#fff",t.style.borderRadius="10px",t.style.boxShadow="0 10px 30px rgba(0,0,0,0.2)",t.style.padding="14px",t.style.boxSizing="border-box",t.style.fontFamily="Segoe UI, system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif",t.addEventListener("click",e=>e.stopPropagation());var l=document.createElement("div");l.innerText="Rename file",l.style.fontSize="13px",l.style.fontWeight="600",l.style.marginBottom="10px",l.style.fontFamily="inherit";var i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.columnGap="8px";var n=document.createElement("input");n.type="text",n.style.flex="1 1 auto",n.style.height="34px",n.style.border="1px solid #c8c8c8",n.style.borderRadius="8px",n.style.padding="0 10px",n.style.fontSize="13px",n.style.outline="none",n.style.fontFamily="inherit";var s=document.createElement("span");s.style.flex="0 0 auto",s.style.fontSize="12px",s.style.color="#666",s.style.padding="0 10px",s.style.height="34px",s.style.display="inline-flex",s.style.alignItems="center",s.style.border="1px solid #e0e0e0",s.style.borderRadius="8px",s.style.background="#fafafa",s.style.fontFamily="inherit",i.appendChild(n),i.appendChild(s);var r=document.createElement("div");r.style.marginTop="8px",r.style.fontSize="12px",r.style.color="#c00000",r.style.display="none";var a=document.createElement("div");a.style.display="flex",a.style.justifyContent="flex-end",a.style.columnGap="8px",a.style.marginTop="12px";var o=document.createElement("button");o.type="button",o.innerText="Cancel",o.style.height="34px",o.style.padding="0 12px",o.style.borderRadius="8px",o.style.border="1px solid #d0d0d0",o.style.background="#fff",o.style.cursor="pointer",o.style.fontFamily="inherit";var d=document.createElement("button");d.type="button",d.innerText="Save",d.style.height="34px",d.style.padding="0 12px",d.style.borderRadius="8px",d.style.border="1px solid #0078d4",d.style.background="#0078d4",d.style.color="#fff",d.style.cursor="pointer",d.style.fontFamily="inherit",this.renameOkButton=d,this.applyRenameOkButtonStyle(),a.appendChild(o),a.appendChild(d),t.appendChild(l),t.appendChild(i),t.appendChild(r),t.appendChild(a),e.appendChild(t),document.body.appendChild(e);var h=()=>this.closeRenameDialog(),m=()=>this.submitRenameDialog();e.addEventListener("click",h),o.addEventListener("click",h),d.addEventListener("click",m),n.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),m()),"Escape"===e.key&&(e.preventDefault(),h())}),this.renameDialogBackdrop=e,this.renameDialog=t,this.renameInput=n,this.renameExtLabel=s,this.renameError=r}}openRenameDialog(e){var t=this.files[e];if(t){this.ensureRenameDialog(),this.currentRenameIndex=e,this.currentRenameExt=this.getFileExt(t.name);var l=this.getFileBase(t.name);this.renameInput&&(this.renameInput.value=l),this.renameExtLabel&&(this.renameExtLabel.innerText=this.currentRenameExt||"(no extension)",this.renameExtLabel.style.display=(this.currentRenameExt,"inline-flex")),this.renameError&&(this.renameError.innerText="",this.renameError.style.display="none"),this.renameDialogBackdrop&&(this.renameDialogBackdrop.style.display="flex"),window.setTimeout(()=>{var e,t;null===(e=this.renameInput)||void 0===e||e.focus(),null===(t=this.renameInput)||void 0===t||t.select()},0)}}closeRenameDialog(){this.renameDialogBackdrop&&(this.renameDialogBackdrop.style.display="none"),this.currentRenameIndex=null,this.currentRenameExt="",this.renameError&&(this.renameError.innerText="",this.renameError.style.display="none")}submitRenameDialog(){var e;if(null!==this.currentRenameIndex){var t=this.files[this.currentRenameIndex];if(t){var l=((null===(e=this.renameInput)||void 0===e?void 0:e.value)||"").trim();if(this.currentRenameExt){var i=l.lastIndexOf(".");i>0&&(l=l.substring(0,i)),l=l.replace(/[.\s]+$/g,"").trim()}if(l){var n=this.currentRenameExt?"".concat(l).concat(this.currentRenameExt):l;console.log("rename file",{index:this.currentRenameIndex,from:t.name,to:n}),t.name=n,this.renderFilesList(),this.notifyOutputChanged(),this.closeRenameDialog()}else this.renameError&&(this.renameError.innerText="Enter a file name.",this.renameError.style.display="block")}else this.closeRenameDialog()}}createIconButton(e,t){var l=document.createElement("button");l.type="button",l.title=e,l.setAttribute("aria-label",e),l.style.width="30px",l.style.height="30px",l.style.display="inline-flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.border="1px solid transparent",l.style.borderRadius="8px",l.style.background="transparent",l.style.cursor="pointer",l.style.padding="0",l.addEventListener("mouseenter",()=>{l.style.background="#f4f4f4",l.style.borderColor="#e5e5e5"}),l.addEventListener("mouseleave",()=>{l.style.background="transparent",l.style.borderColor="transparent"});var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 24 24"),i.setAttribute("width","18"),i.setAttribute("height","18");var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n.setAttribute("fill","none"),n.setAttribute("stroke","#555"),n.setAttribute("stroke-width","2.2"),n.setAttribute("stroke-linecap","round"),n.setAttribute("stroke-linejoin","round"),i.appendChild(n),l.appendChild(i),l}init(e,t,l,i){console.log("CanvasFileDropzone.init start"),this.notifyOutputChanged=t,this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.alignItems="stretch",this.container.style.justifyContent="flex-start",this.container.style.boxSizing="border-box",this.container.style.height="100%",this.container.style.minHeight="0";var n=document.createElement("div");n.style.border="2px dashed #888",n.style.borderRadius="8px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.padding="16px",n.style.minHeight="80px",n.style.boxSizing="border-box",n.style.cursor="pointer",this.labelElement=document.createElement("div"),this.labelElement.innerText=e.parameters.dropText.raw||"Drag and drop files, or click to upload",this.labelElement.style.textAlign="center",n.appendChild(this.labelElement),this.progressElement=document.createElement("div"),this.progressElement.style.marginTop="6px",this.progressElement.style.height="4px",this.progressElement.style.width="100%",this.progressElement.style.background="#eee",this.progressElement.style.borderRadius="2px",this.progressElement.style.overflow="hidden",this.progressElement.style.display="none";var s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.background="#0078d4",s.style.opacity="0.6",this.progressElement.appendChild(s),this.errorElement=document.createElement("div"),this.errorElement.style.marginTop="4px",this.errorElement.style.fontSize="11px",this.errorElement.style.color="#c00000",this.errorElement.style.display="none",this.filesListElement=document.createElement("div"),this.filesListElement.style.marginTop="8px",this.filesListElement.style.display="flex",this.filesListElement.style.flexDirection="column",this.filesListElement.style.rowGap="4px",this.filesListElement.style.flex="1 1 auto",this.filesListElement.style.minHeight="0",this.filesListElement.style.overflowY="auto",this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!0,this.fileInput.style.display="none",this.container.appendChild(n),this.container.appendChild(this.progressElement),this.container.appendChild(this.errorElement),this.container.appendChild(this.filesListElement),i.appendChild(this.container),i.appendChild(this.fileInput),this.ensureRenameDialog(),this.renderFilesList(),n.addEventListener("click",()=>{console.log("dropZone click"),this.fileInput?this.fileInput.click():console.warn("fileInput not defined on click")}),n.addEventListener("dragover",e=>{e.preventDefault(),console.log("dropZone dragover")}),n.addEventListener("drop",e=>{var t,l;e.preventDefault(),console.log("dropZone drop",{hasFiles:!!(null===(t=e.dataTransfer)||void 0===t?void 0:t.files)}),(null===(l=e.dataTransfer)||void 0===l?void 0:l.files)&&this.handleFiles(e.dataTransfer.files)}),this.fileInput.addEventListener("change",()=>{console.log("fileInput change",{filesCount:this.fileInput.files?this.fileInput.files.length:0}),this.fileInput.files&&this.handleFiles(this.fileInput.files)}),console.log("CanvasFileDropzone.init end")}setLoading(e){this.isLoading=e,this.progressElement&&(this.progressElement.style.display=e?"block":"none"),console.log("setLoading",{loading:e})}setError(e){this.errorElement&&(null!==this.errorTimeoutId&&(window.clearTimeout(this.errorTimeoutId),this.errorTimeoutId=null),e&&e.length>0?(this.errorElement.innerText=e,this.errorElement.style.display="block",this.errorTimeoutId=window.setTimeout(()=>{this.errorElement.innerText="",this.errorElement.style.display="none",this.errorTimeoutId=null},5e3)):(this.errorElement.innerText="",this.errorElement.style.display="none"),console.log("setError",{message:e}))}isFileAllowed(e){if(!this.allowedFormats||0===this.allowedFormats.trim().length)return!0;var t=this.allowedFormats.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0);if(0===t.length)return!0;var l=(e.type||"").toLowerCase(),i=e.name.toLowerCase();for(var n of t){if("*"===n)return!0;if(n.endsWith("/*")){var s=n.replace("/*","");if(l.startsWith(s+"/"))return!0}else if(n.startsWith(".")){if(i.endsWith(n))return!0}else if(n.includes("/")&&l===n)return!0}return!1}handleFiles(e){console.log("handleFiles start",{fileCount:e.length}),this.setError(null);var t=Array.from(e),l=t.filter(e=>!this.isFileAllowed(e));if(l.length>0){var i=l.length;this.setError("".concat(1===i?"A file was not uploaded":"Some files were not uploaded",". Allowed formats: ").concat(this.allowedFormats||"any",".")),t=t.filter(e=>this.isFileAllowed(e))}var n=t;if(null!==this.maxFiles){var s=this.maxFiles-this.files.length;if(console.log("handleFiles maxFiles check",{maxFiles:this.maxFiles,existing:this.files.length,remaining:s}),s<=0)return this.setError("No more files can be added. Maximum number of files is ".concat(this.maxFiles,".")),void console.warn("handleFiles: no remaining slots for files");n.length>s&&(this.setError("Some files were not uploaded. Maximum number of files is ".concat(this.maxFiles,".")),n=n.slice(0,s))}if(0!==n.length){var r=n.map(e=>this.readFile(e));return console.log("handleFiles: created read tasks",{tasksCount:r.length}),this.setLoading(!0),Promise.all(r).then(e=>(console.log("handleFiles: Promise.all resolved",{descriptorsCount:e.length}),this.files=[...this.files,...e],this.renderFilesList(),this.notifyOutputChanged(),null)).catch(e=>{console.error("handleFiles error",e)}).finally(()=>{this.setLoading(!1),console.log("handleFiles end")})}console.warn("handleFiles: newFiles is empty after filtering")}renderFilesList(){if(console.log("renderFilesList",{filesCount:this.files.length}),this.filesListElement){this.filesListElement.innerHTML="";var e=document.createElement("div");e.style.fontSize="11px",e.style.color="#555";var t=this.files.length;e.innerText=0===t?"No files selected":1===t?"1 file selected":"".concat(t," files selected"),this.filesListElement.appendChild(e),this.files.forEach((e,t)=>{var l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.fontSize="12px",l.style.color="#333",l.style.columnGap="8px";var i=document.createElement("span");i.innerText=e.name,i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap",i.style.flex="1 1 auto";var n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.columnGap="6px",n.style.flex="0 0 auto";var s=this.createIconButton("Rename","M12 20h9 M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z");s.addEventListener("click",()=>{console.log("rename file click",{index:t,name:e.name}),this.openRenameDialog(t)});var r=this.createIconButton("Remove","M18 6L6 18 M6 6l12 12");r.addEventListener("click",()=>{console.log("remove file click",{index:t,name:e.name}),this.files.splice(t,1),this.renderFilesList(),this.notifyOutputChanged()}),n.appendChild(s),n.appendChild(r),l.appendChild(i),l.appendChild(n),this.filesListElement.appendChild(l)})}else console.warn("renderFilesList: filesListElement missing")}readFile(e){return console.log("readFile",{name:e.name,size:e.size,type:e.type}),new Promise((t,l)=>{var i=new FileReader;i.onload=()=>{var l=i.result.split(",")[1]||"";t({name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,content:l})},i.onerror=()=>{console.error("readFile error",i.error),l(i.error)},i.readAsDataURL(e)})}updateView(e){var t,l,i;this.maxFiles=null!=e.parameters.maxFiles.raw?Number(e.parameters.maxFiles.raw):10,this.allowedFormats=e.parameters.allowedFormats.raw||null,this.saveButtonColor=(null===(t=e.parameters.saveButtonColor)||void 0===t?void 0:t.raw)||null,this.applyRenameOkButtonStyle();var n=null!==(i=null===(l=e.parameters.reset)||void 0===l?void 0:l.raw)&&void 0!==i?i:null;null!==n&&n!==this.lastResetToken&&(console.log("reset token changed",{from:this.lastResetToken,to:n}),this.lastResetToken=n,this.files.length>0&&this.clearFiles());var s=e.parameters.dropText.raw;if(this.labelElement&&(this.labelElement.innerText=s&&s.length>0?s:"Drag and drop files, or click to upload"),this.fileInput&&(this.fileInput.accept=this.allowedFormats&&this.allowedFormats.length>0?this.allowedFormats:""),this.container){var r=e.mode.allocatedWidth,a=e.mode.allocatedHeight;r>0&&(this.container.style.width="".concat(r,"px")),a>0&&(this.container.style.height="".concat(a,"px"))}console.log("updateView",{maxFiles:this.maxFiles,allowedFormats:this.allowedFormats,width:e.mode.allocatedWidth,height:e.mode.allocatedHeight})}getOutputs(){var e=JSON.stringify(this.files);return console.log("getOutputs",{length:this.files.length}),{filesJson:e}}destroy(){console.log("CanvasFileDropzone.destroy"),this.renameDialogBackdrop&&this.renameDialogBackdrop.parentElement&&this.renameDialogBackdrop.parentElement.removeChild(this.renameDialogBackdrop),this.renameDialogBackdrop=null,this.renameDialog=null,this.renameInput=null,this.renameExtLabel=null,this.renameError=null,this.currentRenameIndex=null,this.currentRenameExt=""}}pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad=t})();
if (window.ComponentFramework && window.ComponentFramework.registerControl) {
	ComponentFramework.registerControl('sbid.CanvasJsonDragDropFileUploader', pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.CanvasJsonDragDropFileUploader);
} else {
	var sbid = sbid || {};
	sbid.CanvasJsonDragDropFileUploader = pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.CanvasJsonDragDropFileUploader;
	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = undefined;
}